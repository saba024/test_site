(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[316],{76381:(e,t,i)=>{"use strict";i.r(t),i.d(t,{NavigationVisuals:()=>g,default:()=>w,visDollhouseNavigation:()=>m,visPanoNavigation:()=>f});var s=i(61864),n=i(92810),o=i(17798),a=i(2569),r=i(20043),c=i(88338),l=i(9037),h=i(85992),d=i(53954),u=i(23254),p=i(34029);class g{constructor(e,t,i){this.engine=e,this.dynamicNumber=t,this.smoothWalk=i,this.active=!1,this.draw=new o.M,Promise.all([this.engine.getModuleBySymbol(n.Aj),this.engine.market.waitForData(h.P),this.engine.getModuleBySymbol(n.hi),this.engine.market.waitForData(p.e)]).then((([e,t,i,s])=>{var n;this.meshQuery=i,this.draw.setStyle({assetBasePath:null!==(n=s.getProperty("assetBasePath"))&&void 0!==n?n:""}),this.draw.addToScene(e.getScene()),this.subscription=t.onChanged((()=>this.update(this.draw,t))),this.subscription.cancel()})),this.engine.getModuleBySymbol(s.Ak).then((e=>{const t="Navigation";[{header:t,setting:"navDebugEnabled",initialValue:()=>this.active,onChange:e=>this.toggle(e),urlParam:!0},{header:t,setting:"Max transition dist",initialValue:()=>c.E.longerTransitionMaxDist,range:[3,50],rangePrecision:1,onChange:e=>c.E.longerTransitionMaxDist=e},{header:t,setting:"accel",initialValue:()=>this.dynamicNumber.acceleration,range:[1,60],rangePrecision:.5,onChange:e=>{this.dynamicNumber.setAccel(e)}},{header:t,setting:"top speed",initialValue:()=>this.dynamicNumber.maxSpeed,range:[1,40],rangePrecision:.5,onChange:e=>this.dynamicNumber.setMaxSpeed(e)},{header:t,setting:"queue ms",initialValue:()=>this.smoothWalk.repeatedQueueDelayMS,range:[0,1e3],onChange:e=>this.smoothWalk.repeatedQueueDelayMS=e}].forEach((t=>e.registerMenuEntry(t)))}))}toggle(e){this.active!==e&&(e||this.draw.toggleAll(!1),e||this.subscription.cancel(),e&&this.subscription.renew(),this.active=e)}update(e,t){const i=this.engine.market.tryGetData(d.Z),s=this.engine.market.tryGetData(l.M),n=this.engine.market.tryGetData(u.O);e&&i&&s&&n&&(e.toggleAll(!1),t.hit&&this.meshQuery.floorIdFromObject(t.hit.object)&&(n.isInside()?f(e,i,s,t.hit.intersection):m(e,i,t.hit.intersection,this.meshQuery)))}}const f=(e,t,i,s)=>{let n=0;const o=s.point.clone().sub(i.pose.position),c=(0,r.Tq)(t,o),l=Math.max(...c.map((e=>e.score))),h=l-5;for(const{sweep:t,score:i}of c)if(t){const o=0===n?"cyan":"orange",r=(0,a.dS)(i,h,l,0,.6);e.line("panosphere"+n++,o).toggle(!0).updatePositions(s.point,t.position).opacity(r);const c=(0,a.dS)(r,0,.6,0,.1);e.sphere("panosphere"+n++,{color:o,opacity:.8}).toggle(!0).update(t.position,c)}},m=(e,t,i,s)=>{let n=0;const o=(0,r.bG)(t,!1,i,s),c=Math.max(...o.map((e=>e.score))),l=c-15;for(const{sweep:t,score:s}of o)if(t){const o=0===n?"cyan":"orange",r=(0,a.dS)(s,l,c,0,1);e.line("panosphere"+n++,o).toggle(!0).updatePositions(i.point,t.position).opacity(r);const h=(0,a.dS)(r,0,1,0,.3);e.sphere("panosphere"+n++,{color:o}).toggle(!0).update(t.position,h)}};function w(e){e.getModuleBySymbol(n.wR).then((t=>{const i=t.navigationWalk,s=i.positionTracker;new g(e,s,i)}))}},83718:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>l});var s=i(69984),n=i(97998),o=i(61864),a=i(92810);const r=new n.Z("raycaster-debug");class c{constructor(e){Promise.all([e.getModuleBySymbol(o.Ak),e.getModuleBySymbol(a.Aj),e.getModuleBySymbol(a.fQ)]).then((([e,t,i])=>{const n=t.getScene(),o=[];let a=!1;const c=()=>{o&&o.forEach((e=>{e.geometry.dispose(),e.material.dispose(),n.remove(e)}))},l=(e,t,a)=>{r.info("draw",{from:e,to:t,faces:a});const c=i.getOctree().getDebugBoundsMesh((0,s.rn)().getHex(),e,t,a);c.frustumCulled=!1,c.updateMatrixWorld(!0),n.add(c),o.push(c)};e.registerMenuButton({header:"Raycaster",buttonName:"Add Octree Level Buttons",callback:()=>{if(!a){for(let t=0;t<=i.getOctree().depth;t++)e.registerMenuButton({header:"Octree Levels",buttonName:`Anything on Level: ${t}`,callback:()=>{c(),l(t,t,!1)}});for(let t=0;t<=i.getOctree().depth;t++)e.registerMenuButton({header:"Octree Faces",buttonName:`Faces on Level: ${t}`,callback:()=>{c(),l(t,t,!0)}});a=!0}}}),e.registerMenuButton({header:"Raycaster",buttonName:"Visualize Octree - All",callback:()=>{c();for(let e=0;e<=i.getOctree().depth;e++)l(e,e,!1)}}),e.registerMenuButton({header:"Raycaster",buttonName:"Visualize Octree - Faces",callback:()=>{c();for(let e=0;e<=i.getOctree().depth;e++)l(e,e,!0)}}),e.registerMenuButton({header:"Raycaster",buttonName:"Clear Octree Visuals",callback:c})}))}}function l(e){new c(e)}},68427:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>w});var s=i(61864),n=i(92810),o=i(81396),a=i(17798),r=i(2569),c=i(56512),l=i(90304),h=i(9037),d=i(85992),u=i(94046);const p=new(i(97998).Z)("raycaster-debug");var g;!function(e){e.normal="normal",e.hitClass="hitClass",e.hitBounds="hitBounds"}(g||(g={}));const f={color:"yellow"};class m{constructor(e){this.engine=e,this.cached={v1:new o.Vector3,v2:new o.Vector3,quat:new o.Quaternion},this.showClass=!1,this.showName=!0,this.showNormal=!1,this.showBounds=!1,this.drawRaycastHitNormal=e=>{const t=this.draw.line(g.normal,"red",4);e&&t.updatePositions(e.point,this.cached.v1.copy(e.point).addScaledVector(e.normal,.2)),t.toggle(null!==e)},this.drawRaycastObjectInfo=(e,t,i,s)=>{const n=this.draw.label(g.hitClass,"X",this.cached.v1,1);if(n.visible=!1,e&&t&&(i||s)){const{position:o,rotation:a}=t.pose,{point:c,object:h}=e,d=i?h.__proto__.constructor.name:"",u=s?""!==h.name?h.name:h.id:"";n.text=`${d} - ${u}`,n.setPosition(c,(e=>t.isOrtho()?e.addScaledVector(l.fU.UP,10):(0,r.Xe)(o,e,1,e))),n.scaleBillboard(o,a,t.pose.projection,t.zoom(),t.height,t.aspect(),.1),n.setOrientation(a),n.visible=!0}},this.drawRaycastHitBounds=e=>{const t=this.draw.boxWire(g.hitBounds,f).toggle(!1);if(e&&e.object&&!(e.object instanceof u.i)&&e.object instanceof o.Mesh){const i=(0,c.A5)(e.object.geometry),s=i.getCenter(this.cached.v1).applyMatrix4(e.object.matrixWorld),n=i.getSize(this.cached.v2).multiply(e.object.scale).multiplyScalar(.5);t.mesh.quaternion.copy(e.object.quaternion),t.toggle(!0).update(s,n)}},this.onPointerDown=()=>{const e=this.data.hit;e&&e.object&&p.warn(e.object,e)},Promise.all([e.getModuleBySymbol(s.Ak),e.market.waitForData(d.P)]).then((([e,t])=>{this.data=t;const i=t.onChanged((()=>this.update(t)));i.cancel();const s=e=>{e?(window.addEventListener("pointerdown",this.onPointerDown),i.renew()):(window.removeEventListener("pointerdown",this.onPointerDown),i.cancel(),this.draw.toggleAll(!1))};e.registerMenuEntry({header:"Raycaster",setting:"raycasterHitDebugging",initialValue:()=>!1,onChange:e=>{s(e)},urlParam:!0}),e.registerMenuEntry({header:"Raycaster",setting:"raycasterHitClass",initialValue:()=>this.showClass,onChange:e=>{this.showClass=e},urlParam:!0}),e.registerMenuEntry({header:"Raycaster",setting:"raycasterHitName",initialValue:()=>this.showName,onChange:e=>{this.showName=e},urlParam:!0}),e.registerMenuEntry({header:"Raycaster",setting:"raycasterHitNormal",initialValue:()=>this.showNormal,onChange:e=>{this.showNormal=e},urlParam:!0}),e.registerMenuEntry({header:"Raycaster",setting:"raycasterHitBounds",initialValue:()=>this.showBounds,onChange:e=>{this.showBounds=e},urlParam:!0})}))}get draw(){return this._draw||(this._draw=new a.M({background:!1,color:"red"}),this.engine.getModuleBySymbol(n.Aj).then((e=>this._draw.addToScene(e.getScene())))),this._draw}update(e){const t=this.engine.market.tryGetData(h.M);this.showNormal&&this.drawRaycastHitNormal(e.hit),this.showBounds&&this.drawRaycastHitBounds(e.hit),this.drawRaycastObjectInfo(e.hit,t,this.showClass,this.showName)}}function w(e){new m(e)}},45053:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>h});var s=i(61864),n=i(92810),o=i(81396),a=i(3968),r=i(96666),c=i(51524);const l="Snapping";async function h(e){const[t,i,h]=await Promise.all([e.getModuleBySymbol(s.Ak),await e.getModuleBySymbol(n.fQ),e.getModuleBySymbol(n.Aj)]),d=i.snapping,u=h.getScene().scene;t.registerMenuEntry({header:l,setting:"snappingMaxLOD",initialValue:()=>c.t.snappingMaxLOD,onChange:e=>{c.t.snappingMaxLOD=e},urlParam:!0,rangePrecision:0,range:[0,3]}),function(e,t,i){const s=new o.BufferGeometry,n=new o.LineSegments(s,new o.LineBasicMaterial({vertexColors:!0}));n.frustumCulled=!1;const r=new o.SphereGeometry(.02,5,5);let c;const h=[16711680,65280,255,16777215],d=new o.Color,u=(new o.Matrix4).identity(),p=new o.Group;let g;function f(){const e=[],i=[],l=[],g=[];t.forEachSnapFeature((t=>{var s,n,o;if(d.setHex(h[(null===(o=null===(n=null===(s=t.meta)||void 0===s?void 0:s.tile)||void 0===n?void 0:n.extras)||void 0===o?void 0:o.level)||0]),t instanceof a.FM){const{start:s,end:n}=t;e.push(s.x,s.y,s.z,n.x,n.y,n.z),i.push(d.r,d.g,d.b,d.r,d.g,d.b)}else t instanceof a.UQ&&(l.push(t.x,t.y,t.z),g.push(d.r,d.g,d.b))}),!0),s.dispose(),s.setAttribute("position",new o.Float32BufferAttribute(e,3)),s.setAttribute("color",new o.Float32BufferAttribute(i,3)),c&&3*c.count===l.length||(c&&(p.remove(c),null==c||c.dispose()),c=new o.InstancedMesh(r,new o.MeshBasicMaterial,l.length/3));for(let e=0;e<l.length;e+=3)c.setMatrixAt(e/3,u.setPosition(l[e],l[e+1],l[e+2])),c.setColorAt(e/3,d.setRGB(g[e],g[e+1],g[e+2]));p.add(n,c)}e.registerMenuEntry({header:l,setting:"Show Snapping Features",initialValue:()=>!1,onChange(e){e?(i.add(p),g=setInterval(f,300)):(null==c||c.dispose(),r.dispose(),s.dispose(),i.remove(p),clearInterval(g))}})}(t,d,u),function(e,t,i,s){const n=[];let a,c;function h(){c||(c=new o.Mesh(new o.BufferGeometry,new o.MeshBasicMaterial({vertexColors:!0})),c.frustumCulled=!1,i.add(c));const e=[],t=[];for(const i of n){let s=0;for(const n of i.surfaces){const i=n.area>.1,o=Math.sin(s++)/2+.5,a=i?0:.2+.8*o,r=i?.2+.8*o:0,c=0;for(const i of n.faces){const s=i.va.vector,n=i.vb.vector,o=i.vc.vector;e.push(s.x,s.y,s.z),e.push(n.x,n.y,n.z),e.push(o.x,o.y,o.z),t.push(a,r,c,a,r,c,a,r,c)}}}c.geometry.dispose(),c.geometry.setAttribute("position",new o.Float32BufferAttribute(e,3)),c.geometry.setAttribute("color",new o.Float32BufferAttribute(t,3))}function d(e){n.push(e.edgeFinder)}[{header:l,setting:"Collect Snapping Surfaces",initialValue:()=>!1,onChange(e){e?s.subscribe(r.x,d):(s.unsubscribe(r.x,d),n.length=0)}},{header:"Snapping",setting:"Show Snapping Surfaces",initialValue:()=>!1,onChange(e){clearInterval(a),e?a=setInterval((()=>{t.preloadMeshSnapping(),h()}),1e3):c&&(c.geometry.dispose(),i.remove(c),c=null)}}].forEach((t=>e.registerMenuEntry(t)))}(t,d,u,e)}},41036:(e,t,i)=>{"use strict";i.r(t),i.d(t,{PanoPreloadVisualizer:()=>y,default:()=>S});var s=i(97998),n=i(61864),o=i(92810),a=i(17798),r=i(48917),c=i(9037),l=i(85992),h=i(53954),d=i(23254),u=i(63252),p=i(81396),g=i(90304),f=i(12039),m=i(67944),w=i(64918);const v=new s.Z("previs");class y{constructor(e,t,i){this.engine=e,this.downloadDescriptorGetter=t,this.prioritizer=i,this.allPreloadedSweeps=new Set,this.active=!1,this.freezeCameraRotation=!1,this.sweepIndex=50,this.useCurrentCriteria=!0,this.showPreloadIds=!0,this.visualTour=!1,this.showSweepLabels=!1,this.draw=new a.M,this.engine.getModuleBySymbol(o.Aj).then((e=>this.draw.addToScene(e.getScene()))),this.engine.market.waitForData(l.P).then((e=>{this.subscription=e.onChanged((()=>this.update(this.draw))),this.subscription.cancel()}));const s=this.engine.market.tryGetData(h.Z);if(s){this.sweepData=s;const e=s.getSweepList(),t=new r.Z((e=>e.id));for(let i of e)i.isObservableProxy&&(i=(new u.ZP).copy(i)),t.add(i);this.sweepMap=t}this.engine.getModuleBySymbol(n.Ak).then((e=>{const t="Pano Preload",i=[{header:t,setting:"ShowVis",initialValue:()=>this.active,onChange:e=>this.toggle(e)},{header:t,setting:"Use Camera",initialValue:()=>this.useCurrentCriteria,onChange:e=>{this.useCurrentCriteria=e,this.update(this.draw)}},{header:t,setting:"Freeze Rotation",initialValue:()=>this.freezeCameraRotation,onChange:e=>{this.freezeCameraRotation=e,this.update(this.draw)}},{header:t,setting:"Show preload ids",initialValue:()=>this.showPreloadIds,onChange:e=>{this.showPreloadIds=e,this.update(this.draw)}},{header:t,setting:"Visual tour",initialValue:()=>this.visualTour,onChange:e=>{this.visualTour=e,this.update(this.draw)}},{header:t,setting:"Pano labels",initialValue:()=>this.showSweepLabels,onChange:e=>{this.showSweepLabels=e,this.update(this.draw)}},{header:t,setting:"Override Sweep",initialValue:()=>0,onChange:e=>this.updateSweepIndex(e),range:[0,this.sweepMap.count()]}];e.registerMenuButton({header:"Pano Preload tour",buttonName:"Tour",callback:()=>{this.activateTourMode()}}),i.forEach((t=>e.registerMenuEntry(t)))}))}updateSweepIndex(e){const t=Math.round(e);this.sweepIndex=t,this.update(this.draw)}toggle(e){this.active!==e&&(e&&this.subscription.renew(),e||(this.subscription.cancel(),this.draw.toggleAll(!1)),this.active=e)}update(e){const t=this.engine.market.tryGetData(h.Z),i=this.engine.market.tryGetData(c.M),s=this.engine.market.tryGetData(d.O);if(!(e&&t&&i&&s))return;if(!this.active||!this.sweepMap)return;if(this.tourMode&&!this.visualTour)return;const n=t.getSweepList(),o=this.useCurrentCriteria?this.prioritizer.priorityCriteria:this.criteria;if(this.useCurrentCriteria){if(this.freezeCameraRotation){if(!o.sweep)return;o.set({position:o.sweep.position,rotation:this.lastCriteria.rotation,direction:g.fU.FORWARD.clone().applyQuaternion(this.lastCriteria.rotation)})}}else if(o.set({sweep:this.sweepData.getSweepByIndex(this.sweepIndex)||null}),!this.freezeCameraRotation){if(!o.sweep)return;o.set({position:o.sweep.position,rotation:i.pose.rotation,direction:g.fU.FORWARD.clone().applyQuaternion(i.pose.rotation)})}if(this.lastCriteria=o.clone(),!o.sweep)return;this.tourMode||this.wipePreloadedData();const a=[];this.prioritizer.priorityCriteria=o,this.prioritizer.filterAndPrioritize(a,this.downloadDescriptorGetter);const r=new Set;let l="";for(const e of a)e&&e.sweep&&(r.has(e.sweep.id)||(r.add(e.sweep.id),l+=`${e.sweep.index}, `),this.allPreloadedSweeps.has(e.sweep.id)||this.allPreloadedSweeps.add(e.sweep.id));const u=new p.Vector3(0,0,-1.5).applyQuaternion(i.pose.rotation),f=(new p.Vector3).copy(i.pose.position).add(u),m=`Current Pano: ${o.sweep.index}\n    ${this.showPreloadIds?`Panos: ${l}`:""}\n    Preload Count (this pano): ${r.size}\n    Total Preloaded: ${this.allPreloadedSweeps.size}`,w=e.label("infoLabel",m,f,.1);if(w.lookAt(i.pose.position),w.setPosition(f),w.text=m,this.drawSweepSpheres(r,o),this.showSweepLabels)for(const t of n){const s=`${t.index}`,n=e.label(t.id,s,t.position,.1);n.text=s,n.setColor(16711680),n.lookAt(i.pose.position)}}drawSweepSpheres(e,t){const i=t.sweep;if(!i)return;this.draw.toggleAll(!1);const s=(new p.Vector3).copy(i.position);s.y+=-.5;for(const t of e){const e=this.sweepData.getSweep(t),n=i===e,o=n?"green":"white",a=(new p.Vector3).copy(e.position);if(a.y+=-.5,this.draw.sphere(e.id+"sphere"+(n&&"source"),{color:o,opacity:1}).update(a,.2).toggle(!0),!n){const t=this.draw.line(`${e.id}-${i.id}`,"white",.05);t.updatePositions(a,s),t.toggle(!0)}}}activateTourMode(){this.tourMode=!0;const e={},t=Math.round(this.sweepIndex),i=this.sweepData.getSweepByIndex(t);i&&this.engine.commandBinder.issueCommand(new f.ju({sweep:i.id})).then((()=>{this.wipePreloadedData(),this.allPreloadedSweeps.clear();const t=this.sweepData.getSweepList(),s=Math.round(.05*t.length);i&&this.tourStep(i,e,s)}))}tourStep(e,t,i,s=0,n=""){const o=e,a=this.sweepData.getSweepList();let r=e;if(!o||o.neighbours.length<=0)return;t[o.id]=!0,n+=`Sweep: ${o.index} Loaded: ${this.allPreloadedSweeps.size}\n`;let c=0;for(;c<a.length;){const e=(o.index+1+c)%a.length,i=this.sweepData.getSweepByIndex(e);if(c++,i&&(r=i,!t[r.id]&&r.id!==o.id&&r))break}if(++s<=i)if(this.visualTour)this.engine.commandBinder.issueCommand(new f.ju({sweep:o.id,rotation:(0,m.n0)(o.position,r.position),transition:w.n.Interpolate})).then((()=>{setTimeout((()=>{this.tourStep(r,t,i,s,n)}),500)}));else{const e=(0,m.n0)(o.position,r.position),a=(new p.Vector3).copy(g.fU.FORWARD).applyQuaternion(e),c=this.prioritizer.priorityCriteria.clone();c.set({direction:a,rotation:e,sweep:o,position:o.position});const l=[];this.prioritizer.priorityCriteria=c,this.prioritizer.filterAndPrioritize(l,this.downloadDescriptorGetter);this.queueToPanoSet(l).forEach((e=>this.allPreloadedSweeps.add(e))),this.tourStep(r,t,i,s,n)}else v.info(`TOUR END\n      Sweeps visited: ${s}\n      Visual: ${this.visualTour}\n      Sweeps preloaded: ${this.allPreloadedSweeps.size}`),v.info(`TOUR INFO\n      ${n}`),this.tourMode=!1}queueToPanoSet(e){const t=new Set;for(const i of e)i&&i.sweep&&(t.has(i.sweep.id)||t.add(i.sweep.id));return t}wipePreloadedData(){const e=this.sweepData.getSweepList();for(const t of e)this.downloadDescriptorGetter.deleteAllTileDownloadDescriptors(t.id)}}function S(e){e.getModuleBySymbol(o.RR).then((t=>{const i=t;"tileDownloader"in i&&new y(e,i.tileDownloader,i.tilePrioritizer)}))}},96769:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var s=i(61864),n=i(92810);async function o(e){const[t,i]=await Promise.all([e.getModuleBySymbol(s.Ak),e.getModuleBySymbol(n.Aj)]),o="WebGL Renderer";let a=null;function r(e){i.threeRenderer.forceContextLoss(),setTimeout((()=>{i.threeRenderer.forceContextRestore()}),e)}t.registerMenuButton({header:o,buttonName:"Lose Context for 0.1 sec",callback:()=>{r(100)}}),t.registerMenuButton({header:o,buttonName:"Lose Context for 5 sec",callback:()=>{r(5e3)}}),t.registerMenuEntry({header:o,setting:"autoLoseContext",initialValue:()=>!1,urlParam:!0,onChange(e){if(e){const e=()=>r(100);e(),a=setInterval(e,1e4)}else clearInterval(a)}})}},17798:(e,t,i)=>{"use strict";i.d(t,{M:()=>x});var s=i(90304),n=i(81396);class o{constructor(e,t,i){return this.thisType=e,this.container=t,this.mesh=i(),this.mesh.name=`${e.name}`,this.material=this.mesh.material,this.geometry=this.mesh.geometry,this}opacity(e){return this.material.opacity=e,this}}function a(e,t){t.forEach((t=>{Object.getOwnPropertyNames(t.prototype).forEach((i=>{e.prototype[i]=t.prototype[i]}))}))}class r{constructor(){this.animationInit=!1}initAnimationMixin(e,t){this.animState={scale:t?t.clone():new n.Vector3(1,1,1),position:e?e.clone():new n.Vector3,target:{scale:t?t.clone():new n.Vector3(1,1,1),position:e?e.clone():new n.Vector3},temp:{pos:new n.Vector3,scale:new n.Vector3,makeScale:new n.Vector3}},this.animationInit=!0}update(e,t){if(!this.animationInit)throw Error(`${r.name} call this.initAnimationMixin() in ${this.style} constructor to enable update, because I said so.`);this.mesh.position.copy(e);const i=this.vector3From(t);return i.equals(this.mesh.scale)||this.mesh.scale.copy(i),this.animState.scale.copy(this.mesh.scale),this.animState.position.copy(this.mesh.position),this.mesh.updateMatrixWorld(!0),this}animate(e,t,i){if(!this.animationInit)throw Error(`${r.name} call this.initAnimationMixin() in ${this.style} constructor to enable animations, because I said so.`);const s=this.vector3From(i);this.animState.target.scale.copy(s),this.animState.target.position.copy(t);const n=this.animState.temp.pos.copy(this.mesh.position).lerp(t,e),o=this.animState.temp.scale.copy(this.mesh.scale).lerp(s,e);return this.update(n,o),this}vector3From(e){if(e instanceof n.Vector3)return this.animState.temp.makeScale.copy(e).clamp(l,h);if("number"==typeof e)return this.animState.temp.makeScale.set(e,e,e).clamp(l,h);throw Error("Unexpected scale input")}}const c=.01,l=new n.Vector3(c,c,c),h=new n.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);class d{toggle(e){return e?this.container.add(this.mesh):this.container.remove(this.mesh),this.isVisible=e,this}}class u extends o{constructor(e,t){super(u,e,(()=>new n.Mesh(new n.BoxGeometry(1,1,1),new n.MeshBasicMaterial(t)))),this.container=e,this.style="Box",this.mesh.frustumCulled=!1,this.geometry.computeBoundingBox(),this.initAnimationMixin()}}a(u,[r,d]);class p extends o{constructor(e,t){super(p,e,(()=>{const e=new n.Box3Helper((new n.Box3).setFromCenterAndSize(new n.Vector3,new n.Vector3(1,1,1)));return new n.LineSegments(e.geometry,e.material)})),this.container=e,this.style="BoxWireframeMesh",t&&this.material.setValues(t),this.mesh.frustumCulled=!1,this.initAnimationMixin()}}a(p,[d,r]);class g extends o{constructor(e,t){super(g,e,(()=>new n.CameraHelper(t))),this.container=e,this.style="CameraHelper",this.updateCamera(t)}updateCamera(e){return this.mesh.camera.copy(this.camWithSaneFarDistance(e)),this.mesh.update(),this}camWithSaneFarDistance(e){const t=e.clone();return t.far=5,t}}a(g,[d]);class f extends o{constructor(e,t){super(f,e,(()=>new n.Mesh(new n.PlaneGeometry(1),new n.MeshBasicMaterial(t)))),this.container=e,this.style="PlaneMesh",this.radius=1;const i=new n.Matrix4;i.makeRotationFromEuler(new n.Euler(-Math.PI/2,0,0,"XYZ")),this.geometry.applyMatrix4(i),this.mesh.frustumCulled=!1,this.initAnimationMixin()}}a(f,[d,r]);class m extends o{constructor(e,t){super(m,e,(()=>new n.Mesh(new n.SphereGeometry(1),new n.MeshBasicMaterial(t)))),this.container=e,this.style="SphereMesh",this.radius=1,this.mesh.frustumCulled=!1,this.initAnimationMixin()}}a(m,[d,r]);var w=i(15462);class v extends o{constructor(e,t){return super(v,e,(()=>new n.Line(new n.BufferGeometry,new n.LineBasicMaterial(Object.assign({color:w.I.MP_BRAND,opacity:1,transparent:!0},t))))),this.container=e,this.positionsBuffer=new n.BufferAttribute(new Float32Array(150),3),this.point=new n.Vector3,this.points={start:new n.Vector3,control:new n.Vector3,end:new n.Vector3},this.updatePoints=(e,t,i)=>{this.points.start.copy(this.curve.v0.copy(e)),this.points.control.copy(this.curve.v1.copy(t)),this.points.end.copy(this.curve.v2.copy(i));for(let e=0;e<50;e++){const t=e/49;this.curve.getPoint(t,this.point),this.positionsBuffer.setXYZ(e,this.point.x,this.point.y,this.point.z)}return this.positionsBuffer.needsUpdate=!0,this},this.animatePoints=(e,t,i,s)=>{const{start:n,control:o,end:a}=this.points;return n.equals(o)&&n.equals(a)?(this.updatePoints(t,i,s),this):(n.lerp(t,e),o.lerp(i,e),a.lerp(s,e),this.updatePoints(n,o,a),this)},this.mesh.frustumCulled=!1,this.curve=new n.QuadraticBezierCurve3(new n.Vector3,new n.Vector3,new n.Vector3),this.geometry.setAttribute("position",this.positionsBuffer),this.geometry.computeBoundingBox(),this}}a(v,[d]);var y=i(67971),S=i(90401),b=i(18718);class x{constructor(e,t={}){this.cache={},this.helperCache={},this.style={},this.toggle=e=>(this.options.scene&&(e?this.options.scene.add(this.options.container):this.options.scene.remove(this.options.container)),this),this.box=(e,t)=>(this.cache[D.box][e]||(this.cache[D.box][e]=new u(this.options.container,t).toggle(!0)),this.cache[D.box][e]),this.boxWire=(e,t)=>(this.cache[D.boxWire][e]||(this.cache[D.boxWire][e]=new p(this.options.container,t).toggle(!0)),this.cache[D.boxWire][e]),this.cam=(e,t)=>(this.cache[D.cameraHelper][e]||(this.cache[D.cameraHelper][e]=new g(this.options.container,t).toggle(!0)),this.cache[D.cameraHelper][e]),this.label=(e,t,i,s=.25)=>{if(!this.labelCreator){const{color:e,backgroundColor:t,backgroundOpacity:i,background:s}=this.options;this.labelCreator=new y.uc(Object.assign({color:e,background:s,backgroundColor:t,backgroundOpacity:i,wordWrapWidth:650},this.style))}if(!this.cache[D.label][e]){const n=this.labelCreator.createLabel();this.cache[D.label][e]=n,n.position.copy(i),n.text=t,n.scaleFactor=s,this.options.container.add(n)}return this.cache[D.label][e]},this.line=(e,t=this.options.lineColor,i=this.options.linewidth)=>{if(!this.cache[D.line][e]){const o=(0,S.makeLineMaterial)("string"==typeof t?new n.Color(t).getHex():t.getHex(),!1,{linewidth:i}),a={onShow:()=>this.options.container.add(...r.children),onHide:()=>this.options.container.remove(...r.children)},r=new b.c(s.fU.ZERO.clone(),s.fU.ZERO.clone(),o,a);r.updateResolution(window.innerWidth,window.innerHeight).opacity(1).toggle(!0),this.cache[D.line][e]=r}return this.cache[D.line][e]},this.plane=(e,t)=>(this.cache[D.plane][e]||(this.cache[D.plane][e]=new f(this.options.container,t).toggle(!0)),this.cache[D.plane][e]),this.setStyle=e=>{this.style=e},this.sphere=(e,t)=>(this.cache[D.sphere][e]||(this.cache[D.sphere][e]=new m(this.options.container,t).toggle(!0)),this.cache[D.sphere][e]),this.triangle=(e,t,i,s,o)=>{if(!this.cache[D.triangle][e]){const a=new Float32Array(9);t.toArray(a,0),i.toArray(a,3),s.toArray(a,6);const r=new n.BufferGeometry;r.setAttribute("position",new n.BufferAttribute(a,3));const c=new n.Mesh(r,new n.MeshBasicMaterial(o));this.options.container.add(c),this.cache[D.triangle][e]=new m(this.options.container,o).toggle(!0)}return this.cache[D.triangle][e]},this.spline=(e,t)=>(this.cache[D.spline][e]||(this.cache[D.spline][e]=new v(this.options.container,t).toggle(!0)),this.cache[D.spline][e]),this.randomColor=e=>{if(void 0!==e){if(!this.helperCache[A.color][e]){const t=new n.Color(M(),M(),M());this.helperCache[A.color][e]=t}return this.helperCache[A.color][e]}return new n.Color(M(),M(),M())},this.randomVector3=e=>{if(void 0!==e){if(!this.helperCache[A.vector3][e]){const t=new n.Vector3(2*(.5-M()),2*(.5-M()),2*(.5-M()));this.helperCache[A.vector3][e]=t}return this.helperCache[A.vector3][e]}return new n.Vector3(2*(.5-M()),2*(.5-M()),2*(.5-M()))},this.toggleAll=e=>{for(const t of Object.values(D)){const i=Object.values(this.cache[t]);for(const t of i)"toggle"in t&&t.toggle(e)}return this},this.options=Object.assign(Object.assign({},C),e),this.style=t;for(const e of Object.values(D))this.cache[e]={};for(const e of Object.values(A))this.helperCache[e]={};this.options.scene&&this.toggle(!0)}async addToScene(e){return this.options.scene=e,this.toggle(!0),this}}const M=()=>Math.random(),C={lineColor:"white",linewidth:2,color:"white",background:!0,backgroundColor:"white",backgroundOpacity:.5,container:new n.Group};var D,A;!function(e){e.box="box",e.boxWire="boxWire",e.label="label",e.line="line",e.plane="plane",e.sphere="sphere",e.spline="spline",e.triangle="triangle",e.cameraHelper="cameraHelper"}(D||(D={})),function(e){e.color="color",e.vector3="vector3"}(A||(A={}))},23454:(e,t,i)=>{"use strict";i.d(t,{Y:()=>a});var s=i(81396),n=i(10840),o=i(66990);class a extends s.RawShaderMaterial{constructor(e,t,i,a=o.V9.lineSelected){super(),this.parameters=e,this.hoverTexture=t,this.defaultTexture=i,this.selectedWidth=a,this.type="LineMaterial",this.isLineMaterial=!0,this.defaultWidth=o.V9.lineDefault,this.setValues({uniforms:s.UniformsUtils.clone(n.T.line.uniforms),vertexShader:n.T.line.vertexShader,fragmentShader:n.T.line.fragmentShader,transparent:!0,depthWrite:!1,depthTest:!0,opacity:1}),this.setValues(e),i&&(this.mask=i),this.defaultWidth=e&&e.linewidth?e.linewidth:o.V9.lineDefault}updateSelected(e){const t=e?this.hoverTexture:this.defaultTexture;t&&this.mask!==t&&(this.mask=t,e?this.setLinewidth(this.selectedWidth):this.setLinewidth(this.defaultWidth))}setLinewidth(e){this.uniforms.linewidth||(this.uniforms=s.UniformsUtils.clone(n.T.line.uniforms)),this.getLinewidth()!==e&&(this.uniforms.linewidth.value=e)}getLinewidth(){return this.uniforms.linewidth.value}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}getOpacity(){return this.uniforms.opacity.value}setOpacity(e){this.uniforms||(this.uniforms=s.UniformsUtils.clone(n.T.line.uniforms)),this.getOpacity()!==e&&(this.uniforms.opacity.value=e)}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}set dashed(e){e?this.defines.USE_DASH="":delete this.defines.USE_DASH,this.needsUpdate=!0}get dashed(){return"USE_DASH"in this.defines}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value=e}set mask(e){this.uniforms.mask.value!==e&&(e?this.defines.USE_MASK="":delete this.defines.USE_MASK,this.uniforms.mask.value=e,this.needsUpdate=!0)}get mask(){return this.uniforms.mask.value}copy(e){return s.RawShaderMaterial.prototype.copy.call(this,e),this.parameters=e.parameters,this.color.copy(e.color),this.defaultWidth=e.defaultWidth,this.setLinewidth(e.getLinewidth()),this.resolution.copy(e.resolution),this.defaultTexture=e.defaultTexture,this.hoverTexture=e.hoverTexture,this.mask=e.mask,this.setOpacity(e.getOpacity()),this.dashed=e.dashed,this.dashScale=e.dashScale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}},10840:(e,t,i)=>{"use strict";i.d(t,{T:()=>f});var s=i(81396),n=i(11677),o=i(44724),a=i.n(o),r=i(7188),c=i.n(r),l=i(52059),h=i.n(l),d=i(75215),u=i.n(d),p=i(56449),g=i.n(p);const f={endpoint:{uniforms:{opacity:{type:"f",value:1},color:{type:"c",value:new s.Color},bg:{type:"t",value:null}},vertexShader:n.Z.basicTextured.vertexShader,fragmentShader:a()},line:{uniforms:s.UniformsUtils.merge([s.UniformsLib.common,s.UniformsLib.fog,{linewidth:{value:4},resolution:{value:new s.Vector2(0,0)},dashScale:{value:1},dashSize:{value:.025},gapSize:{value:.05},mask:{value:null}}]),vertexShader:c(),fragmentShader:h()},screenline:{uniforms:{lineWidth:{value:1},screenSize:{value:new s.Vector2(0,0)},dashed:{value:0},dashSize:{value:1},gapSize:{value:1},antialiasWidth:{value:1},color:{value:new s.Color(1,0,0)},opacity:{value:1},start:{value:new s.Vector3},end:{value:new s.Vector3}},vertexShader:u(),fragmentShader:g()}}},66990:(e,t,i)=>{"use strict";i.d(t,{Ey:()=>o,V9:()=>n,g4:()=>a,iV:()=>s});const s={FADE_DURATION:100,LABEL_HIDDEN_OPACITY:.15,DEPTH_WRITE_THRESHOD:.15,ALIGN_LABELS:!1,LABEL_SIZING:.14,LABEL_NDC_SCALEFACTOR:.5,LABEL_ASPECT_SCALEFACTOR:.035,OFFSET_TOWARDS_CAMERA:.25,HIDE_LABELS:!1},n={dottedLineDefault:2,lineDefault:6,lineSelected:6,endpointDefault:2.5,endpointSelected:3.75},o=.01,a=5},21270:(e,t,i)=>{"use strict";var s;i.d(t,{V:()=>s}),function(e){e[e.Min=0]="Min",e[e.Standard=1]="Standard",e[e.High=2]="High",e[e.Detail=3]="Detail"}(s||(s={}))},51524:(e,t,i)=>{"use strict";i.d(t,{t:()=>r});var s=i(59279),n=i(53261),o=i(31362),a=i(21270);const r={urlTemplateToken:"<file>",initialMaxLOD:a.V.Min,nonMeshMaxLOD:a.V.Standard,maxLOD:a.V.High,minLOD:a.V.Min,loadSiblings:!0,displayActiveTiles:!1,autoDisableRendererCulling:!0,optimizeRaycast:!1,stopAtEmptyTiles:!1,disableTileUpdates:!1,disposeModel:!1,limitMemoryUsage:(0,o.tq)(),allocatedMegsBeforeLimitingLod:350,lruMinExtraTiles:(0,o.tq)()?0:100,lruMaxTiles:800,lruUnloadPercent:.05,tileAssetRequestPriority:n.ru.MEDIUM,downloadQueueConcurrency:8,parseQueueConcurrency:10,snappingMaxLOD:a.V.Standard,errorTarget:Number((0,s.eY)("errorTarget",(0,o.tq)()?6:4)),errorMultiplierHiddenFloors:.01,errorMultiplierRaycastOcclusion:.1,smallMeshThreshold:Number((0,s.eY)("smallMeshThreshold",40)),smallMeshErrorMultiplier:Number((0,s.eY)("smallMeshErrorMultiplier",.1))}},88338:(e,t,i)=>{"use strict";i.d(t,{E:()=>s});const s={longerTransitionMaxDist:10,TRANSITION_TIME_DH:650,TRANSITION_TIME_ROOM:800}},20043:(e,t,i)=>{"use strict";i.d(t,{Gs:()=>c,Tq:()=>l,bG:()=>d});var s=i(98169),n=i(81248),o=i(88338);if(984==i.j)var a=i(35895);if(984==i.j)var r=i(12039);function c(e){return(0,a.k1)((()=>e(new r.ZK)),(()=>e(new r.Lp)),!1)}const l=(e,t,i,s,...n)=>h({sweepData:e,direction:t,directionFactor:i,sourceSweep:s,ignoreSweeps:n}),h=e=>{const{sweepData:t,direction:i,sourceSweep:o,ignoreSweeps:a,directionFactor:r}=e;if(!t.currentSweepObject)return[];const c=o||t.currentSweepObject,l=[s.ff(c),s._k(),s.vO(c),s.pI(c.position,i,r)];for(const e of a)l.push(s.ff(e));const h=[n.o7(c.position,i),n.TE(c.position)],d=t.getSweepNeighbours(c);return t.sortByScore(l,h,d)},d=(e,t,i,a)=>{const r=[s._k(),s._T()],c=[n.Dv(i.point)],l=e.currentSweepObject;t&&l&&r.push(s.ff(l),s.SF(l.position,o.E.longerTransitionMaxDist),s.vO(l)),i.face&&r.push(s.D5(i.point,i.face.normal));const h=a.floorIdFromObject(i.object);h&&c.push(n.Bv(h));const d=e.sortByScore(r,c);if(0===d.length){const t=e.getClosestSweep(i.point,!0);d.push({sweep:t,score:0})}return d}},94046:(e,t,i)=>{"use strict";i.d(t,{i:()=>n});var s=i(81396);class n extends s.Mesh{}},81248:(e,t,i)=>{"use strict";i.d(t,{Bv:()=>u,Dv:()=>c,TE:()=>l,l0:()=>d,o7:()=>h});var s=i(81396);const n=-1,o=10,a=5,r=-5,c=(e,t=n)=>i=>e.distanceToSquared(i.position)*t,l=(e,t=n)=>i=>e.distanceTo(i.position)*t,h=(e,t,i=o)=>{const n=new s.Vector3;return s=>n.copy(s.position).sub(e).normalize().dot(t)*i},d=(e,t=n)=>i=>e.distanceToSquared(i.floorPosition)*t,u=(e,t=a,i=r)=>s=>e===s.floorId?t:i},69984:(e,t,i)=>{"use strict";i.d(t,{D5:()=>l,Ex:()=>h,G1:()=>r,rn:()=>c});var s=i(81396),n=i(39880);const o=()=>Math.random(),a={},r=(e,t=o())=>(a[t]||(a[t]=new s.Vector4(o(),o(),o(),e)),a[t]),c=()=>new s.Color(o(),o(),o()),l=e=>e instanceof Object&&"r"in e&&"g"in e&&"b"in e;function h(e){return`#${(0,n.Q_)(255*e.r,2,"0",16)}${(0,n.Q_)(255*e.g,2,"0",16)}${(0,n.Q_)(255*e.b,2,"0",16)}`}},67971:(e,t,i)=>{"use strict";i.d(t,{$7:()=>h,uc:()=>u,N3:()=>l});var s=i(81396),n=i(4679),o=i(59370),a=i(69505),r=i(49827),c=i(67944);var l;(0,n.Dy)({unicodeFontsURL:"https://static.matterport.com/webgl-vendors/unicode-font-resolver/1.0.1/"}),function(e){e.WORLD="world",e.NDC="ndc"}(l||(l={}));class h extends s.Object3D{constructor(e,t=l.WORLD){var i,o,a,r;super(),this.config=e,this.scaleType=t,this.unscaledWidth=0,this.unscaledHeight=0,this.labelTextMaterial=new s.MeshBasicMaterial,this.bindings=[];const c=this.config.background||this.config.backgroundAsCollider;if(c){this.config.backgroundOpacity=void 0!==this.config.backgroundOpacity?this.config.backgroundOpacity:1,this.config.backgroundOpacity=this.config.background?this.config.backgroundOpacity:0;const t=new s.BoxGeometry(1,1,.01),i=new s.MeshBasicMaterial({color:e.backgroundColor,transparent:!0,depthTest:this.config.backgroundOpacity>0&&!e.disableDepth,depthWrite:this.config.backgroundOpacity>0&&!e.disableDepth,opacity:this.config.backgroundOpacity,stencilRef:1,stencilFail:s.KeepStencilOp,stencilZFail:s.KeepStencilOp,stencilZPass:s.ReplaceStencilOp,stencilFunc:s.AlwaysStencilFunc,stencilWrite:!0});this.labelBackgroundMesh=new this.config.backgroundColliderType(t,i),this.labelBackgroundMesh.position.z=-.01,this.labelBackgroundMesh.name="Label Background",this.collider=this.labelBackgroundMesh,this.add(this.labelBackgroundMesh)}const h=this.labelTextMesh=new n.xv;h.material=this.labelTextMaterial,h.name="Label Text",h.text=e.text||"",h.renderOrder=10,h.font=`${null!==(i=e.assetBasePath)&&void 0!==i?i:""}${e.fontPath}`,h.lang=e.lang,h.fontSize=1,h.fontWeight=700,h.anchorX="50%",h.anchorY="50%",h.outlineWidth=e.outline?e.outlineWidth:0,h.maxWidth=e.wordWrapWidth,h.textAlign=e.align,h.depthOffset=e.depthOffset||0,c&&(h.raycast=()=>{}),h.addEventListener("synccomplete",(()=>{var e;const[t,i,s,n]=h.textRenderInfo.visibleBounds;let o=s-t,a=n-i;c&&(o+=this.config.backgroundBorderWidth,a+=this.config.backgroundBorderHeight,this.labelBackgroundMesh.scale.set(o,a,1)),this.unscaledWidth=o,this.unscaledHeight=a,this.aspect=o/Math.max(a,.001),h.position.set((t+s)/-2,(i+n)/-2,0),null===(e=this._onGeomUpdate)||void 0===e||e.call(this)})),this.scaleFactor=null!==(o=e.scale)&&void 0!==o?o:1,this.opacity=null!==(a=e.opacity)&&void 0!==a?a:1,this.setColor(null!==(r=e.color)&&void 0!==r?r:0),this.add(h),h.sync(),this.name="Label Container"}dispose(){this.bindings.forEach((e=>e.cancel())),this.labelTextMesh.dispose()}onGeomUpdate(e){this._onGeomUpdate=e}get text(){return this.config.text}set text(e){this.config.text=e,this.labelTextMesh.text=e,this.labelTextMesh.sync()}get mesh(){return this.labelTextMesh}getUnscaledSize(){return{width:this.unscaledWidth,height:this.unscaledHeight}}get scaleFactor(){return this.config.scale}set scaleFactor(e){this.config.scale=e,this.scale.setScalar(e)}get opacity(){return void 0!==this.config.opacity?this.config.opacity:1}set opacity(e){if(e!==this.config.opacity){this.config.opacity=e;const t=e>0&&!this.config.disableDepth;if(this.config.background){const i=this.labelBackgroundMesh.material;i.opacity=Math.min(this.config.backgroundOpacity||1,e),i.depthWrite=e>.15,i.depthTest=t}const i=this.labelTextMaterial;i.opacity=e,i.depthTest=t,this.visible=e>0}}setColor(e){this.labelTextMaterial.color.set(e)}setRenderLayer(e){this.labelTextMesh.layers.mask=e.mask,this.labelBackgroundMesh&&(this.labelBackgroundMesh.layers.mask=e.mask)}setRenderOrder(e){this.renderOrder=e,this.labelTextMesh.renderOrder=e,this.labelBackgroundMesh&&(this.labelBackgroundMesh.renderOrder=e)}setPosition(e,t=(e=>e)){this.position.copy(t(e))}setOrientation(e,t=0){this.quaternion.copy(e),0!==t&&this.rotateZ(-t*a.Ue)}scaleBillboard(e,t,i,s,n,a,h=d.SCALE_DEFAULT){if(0!==i.elements[15])this.scaleFactor=.2*h*s*(d.ORTHO_IDEAL_HEIGHT/n);else{const u=(0,o.D_)(this.position,e,t,i.asThreeMatrix4()),p=Math.abs(u.x);if(p<1){const t=(0,c.mY)(i,e,this.position,n,h),o=((0,r.uZ)(a,1,2.5)+s)*d.SCALE_ASPECT,u=1+d.SCALE_NDC-p*d.SCALE_NDC-o,g=Math.max(Math.min(1/t*u,3),.001);this.scaleType===l.NDC?this.scaleFactor=g:this.scaleFactor=Math.min(g*d.NDC_MULT,h*d.SCALE_WORLD)}else this.scaleFactor=.001}}}const d={SCALE_DEFAULT:.1,SCALE_WORLD:4,SCALE_NDC:.5,SCALE_ASPECT:.035,DEPTH_WRITE_THRESHOD:.15,ORTHO_IDEAL_HEIGHT:1500,NDC_MULT:1.15};class u{constructor(e){this.currentTextConfig=u.defaultTextConfig,e?this.updateTextStyle(e):this.updateTextStyle(u.defaultTextConfig)}updateTextStyle(e){this.currentTextConfig=Object.assign(Object.assign({},this.currentTextConfig),e)}createLabel(e={text:""}){return new h(Object.assign(Object.assign({},this.currentTextConfig),e))}async preload(e={text:""}){const t=Object.assign(Object.assign({},this.currentTextConfig),e);return new Promise((e=>{var i;(0,n.C5)({font:`${null!==(i=t.assetBasePath)&&void 0!==i?i:""}${t.fontPath}`,characters:t.text},e)}))}static makeConfig(e){return Object.assign(Object.assign({},u.defaultTextConfig),e)}}u.defaultTextConfig={text:"",fontPath:"fonts/roboto-700.woff",align:"center",wordWrapWidth:void 0,color:"black",backgroundColor:"white",backgroundBorderWidth:.9,backgroundBorderHeight:.7,background:!0,backgroundAsCollider:!0,backgroundColliderType:s.Mesh,scale:1,outline:!1,outlineWidth:.06}},44724:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;uniform float opacity;uniform vec3 color;uniform sampler2D bg;varying vec2 vUv;void main(){vec4 bgColor=texture2D(bg,vUv);gl_FragColor=vec4(bgColor.rgb,bgColor.a*opacity);}"},52059:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;uniform vec3 diffuse;uniform float opacity;uniform sampler2D mask;\n#ifdef USE_DASH\nuniform float dashSize;uniform float gapSize;\n#endif\nvarying float vLineDistance;\n#include <common>\nvarying vec2 vUv;void main(){\n#ifdef USE_DASH\nif(vUv.y<-1.||vUv.y>1.)discard;if(mod(vLineDistance,dashSize+gapSize)>dashSize)discard;\n#endif\n#ifdef USE_MASK\nvec2 modUv=vec2(vUv);modUv*=2.;vec4 texelColor=texture2D(mask,modUv);gl_FragColor=vec4(texelColor.rgb,min(texelColor.a,opacity));\n#else\ngl_FragColor=vec4(diffuse,opacity);\n#endif\n}"},7188:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;\n#include <common>\nuniform float linewidth;uniform vec2 resolution;attribute vec3 instanceStart;attribute vec3 instanceEnd;attribute vec3 instanceColorStart;attribute vec3 instanceColorEnd;varying vec2 vUv;\n#ifdef USE_DASH\nuniform float dashScale;attribute float instanceDistanceStart;attribute float instanceDistanceEnd;varying float vLineDistance;\n#endif\nvoid trimSegment(const in vec4 start,inout vec4 end){float a=projectionMatrix[2][2];float b=projectionMatrix[3][2];float nearEstimate=-0.5*b/a;float alpha=(nearEstimate-start.z)/(end.z-start.z);end.xyz=mix(start.xyz,end.xyz,alpha);}void main(){\n#ifdef USE_COLOR\nvColor.xyz=(position.y<0.5)?instanceColorStart:instanceColorEnd;\n#endif\n#ifdef USE_DASH\nvLineDistance=(position.y<0.5)?dashScale*instanceDistanceStart:dashScale*instanceDistanceEnd;\n#endif\nfloat aspect=resolution.x/resolution.y;vUv=uv;vec4 start=modelViewMatrix*vec4(instanceStart,1.);vec4 end=modelViewMatrix*vec4(instanceEnd,1.);bool perspective=(projectionMatrix[2][3]==-1.);if(perspective){if(start.z<0.&&end.z>=0.){trimSegment(start,end);}else if(end.z<0.&&start.z>=0.){trimSegment(end,start);}}vec4 clipStart=projectionMatrix*start;vec4 clipEnd=projectionMatrix*end;vec2 ndcStart=clipStart.xy/clipStart.w;vec2 ndcEnd=clipEnd.xy/clipEnd.w;vec2 dir=ndcEnd-ndcStart;dir.x*=aspect;dir=normalize(dir);vec2 offset=vec2(dir.y,-dir.x);dir.x/=aspect;offset.x/=aspect;if(position.x<0.)offset*=-1.;offset*=linewidth;offset/=resolution.y;vec4 clip=(position.y<0.5)?clipStart:clipEnd;\n#ifdef USE_MASK\noffset*=(clipEnd.w+clipStart.w)*0.5;\n#else\noffset*=clip.w;\n#endif\nclip.xy+=offset;gl_Position=clip;\n#include <worldpos_vertex>\n}"},56449:e=>{e.exports="precision highp float;uniform vec3 color;uniform float antialiasWidth;uniform float lineWidth;uniform float dashed;uniform float dashSize;uniform float gapSize;uniform float opacity;varying float vDistanceFromAxis;varying float vDistanceAlong;void main(){float halfWidth=lineWidth*0.5;float antialiasing=1.-smoothstep(halfWidth,halfWidth+antialiasWidth,vDistanceFromAxis);float dashOpacity=1.;if(dashed>0.){\n#ifdef WORLDSPACE_DASH\nfloat dashAA=fwidth(vDistanceAlong)*antialiasWidth*0.5;\n#else\nfloat dashAA=antialiasWidth*0.5;\n#endif\nfloat dashT=mod(vDistanceAlong,dashSize+gapSize);dashOpacity=smoothstep(0.,dashAA,dashT)*(1.-smoothstep(dashSize-dashAA,dashSize,dashT));}gl_FragColor=vec4(color,opacity*dashOpacity*antialiasing);}"},75215:e=>{e.exports="precision highp float;uniform vec2 screenSize;vec2 rotate90(vec2 v){return vec2(-v.y,v.x);}vec2 ndcToScreen(vec4 pt){return pt.xy*screenSize/2.;}vec2 screenToNdc(vec2 pt){return pt*2./screenSize;}uniform vec3 start;uniform vec3 end;uniform float lineWidth;uniform float antialiasWidth;uniform mat4 projectionMatrix;uniform mat4 modelViewMatrix;attribute float offsetDirection;attribute float t;varying float vDistanceFromAxis;varying float vDistanceAlong;void main(){vec4 startNdc=projectionMatrix*modelViewMatrix*vec4(start,1.);vec4 endNdc=projectionMatrix*modelViewMatrix*vec4(end,1.);float z=mix(startNdc.z,endNdc.z,t);float w=mix(startNdc.w,endNdc.w,t);vec2 startScreen=ndcToScreen(startNdc/startNdc.w);vec2 endScreen=ndcToScreen(endNdc/endNdc.w);float halfWidth=lineWidth*0.5+antialiasWidth;vec2 directionScreen=endScreen-startScreen;vec2 widthOffsetScreen=rotate90(normalize(directionScreen))*offsetDirection*halfWidth;vec2 position=startScreen+directionScreen*t+widthOffsetScreen;vDistanceFromAxis=length(widthOffsetScreen);\n#ifdef WORLDSPACE_DASH\nvDistanceAlong=length((end-start)*t);\n#else\nvDistanceAlong=length(directionScreen*t);\n#endif\nvec2 posNdc=screenToNdc(position);gl_Position=vec4(posNdc*w,z,w);}"}}]);